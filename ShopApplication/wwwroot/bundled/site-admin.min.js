var tedu={configs:{pageSize:10,pageIndex:1},notify:function(e,t){$.notify(e,{clickToHide:!0,autoHide:!0,autoHideDelay:5e3,arrowShow:!0,arrowSize:5,position:"...",elementPosition:"top right",globalPosition:"top right",style:"bootstrap",className:t,showAnimation:"slideDown",showDuration:400,hideAnimation:"slideUp",hideDuration:200,gap:2})},confirm:function(e,t){bootbox.confirm({message:e,buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Hủy",className:"btn-danger"}},callback:function(e){e===!0&&t()}})},dateFormatJson:function(e){if(null==e||""==e)return"";var t=new Date(parseInt(e.substr(6))),n=t.getMonth()+1,a=t.getDate(),o=t.getFullYear(),i=t.getHours(),r=t.getMinutes();return n<10&&(n="0"+n),a<10&&(a="0"+a),i<10&&(i="0"+i),r<10&&(r="0"+r),a+"/"+n+"/"+o},dateTimeFormatJson:function(e){if(null==e||""==e)return"";var t=new Date(parseInt(e.substr(6))),n=t.getMonth()+1,a=t.getDate(),o=t.getFullYear(),i=t.getHours(),r=t.getMinutes(),d=t.getSeconds();return n<10&&(n="0"+n),a<10&&(a="0"+a),i<10&&(i="0"+i),r<10&&(r="0"+r),d<10&&(d="0"+d),a+"/"+n+"/"+o+" "+i+":"+r+":"+d},startLoading:function(){$(".dv-loading").length>0&&$(".dv-loading").removeClass("hide")},stopLoading:function(){$(".dv-loading").length>0&&$(".dv-loading").addClass("hide")},getStatus:function(e){return 1==e?'<span class="badge bg-green">Kích hoạt</span>':'<span class="badge bg-red">Khoá</span>'},formatNumber:function(e,t){if(!isFinite(e))return e.toString();var n=e.toFixed(t).split(".");return n[0]=n[0].replace(/\d(?=(\d{3})+$)/g,"$&,"),n.join(".")},unflattern:function(e){for(var t={},n=[],a=0;a<e.length;a+=1){var o=e[a];o.children=[],t[o.id]=a,null!==o.parentId?e[t[o.parentId]].children.push(o):n.push(o)}return n}};$(document).ajaxSend(function(e,t,n){if("POST"==n.type.toUpperCase()||"PUT"==n.type.toUpperCase()){var a=$("form").find("input[name='__RequestVerificationToken']").val();t.setRequestHeader("RequestVerificationToken",a)}});var BillController=function(){function e(){$("#txtFromDate, #txtToDate").datepicker({autoclose:!0,format:"dd/mm/yyyy"}),$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"vi",rules:{txtCustomerName:{required:!0},txtCustomerAddress:{required:!0},txtCustomerMobile:{required:!0},txtCustomerMessage:{required:!0},ddlBillStatus:{required:!0}}}),$("#txt-search-keyword").keypress(function(e){13===e.which&&(e.preventDefault(),s())}),$("#btn-search").on("click",function(){s()}),$("#btn-create").on("click",function(){l(),$("#modal-detail").modal("show")}),$("#ddl-show-page").on("change",function(){tedu.configs.pageSize=$(this).val(),tedu.configs.pageIndex=1,s(!0)}),$("body").on("click",".btn-view",function(e){e.preventDefault();var t=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Bill/GetById",data:{id:t},beforeSend:function(){tedu.startLoading()},success:function(e){var t=e;$("#hidId").val(t.Id),$("#txtCustomerName").val(t.CustomerName),$("#txtCustomerAddress").val(t.CustomerAddress),$("#txtCustomerMobile").val(t.CustomerMobile),$("#txtCustomerMessage").val(t.CustomerMessage),$("#ddlPaymentMethod").val(t.PaymentMethod),$("#ddlCustomerId").val(t.CustomerId),$("#ddlBillStatus").val(t.BillStatus);var n=t.BillDetails;if(null!=t.BillDetails&&t.BillDetails.length>0){var a="",o=$("#template-table-bill-details").html();$.each(n,function(e,t){var n=r(t.ProductId),i=d(t.ColorId),l=c(t.SizeId);a+=Mustache.render(o,{Id:t.Id,Products:n,Colors:i,Sizes:l,Quantity:t.Quantity})}),$("#tbl-bill-details").html(a)}$("#modal-detail").modal("show"),tedu.stopLoading()},error:function(e){tedu.notify("Has an error in progress","error"),tedu.stopLoading()}})}),$("#btnSave").on("click",function(e){if($("#frmMaintainance").valid()){e.preventDefault();var t=$("#hidId").val(),n=$("#txtCustomerName").val(),a=$("#txtCustomerAddress").val(),o=$("#ddlCustomerId").val(),i=$("#txtCustomerMobile").val(),r=$("#txtCustomerMessage").val(),d=$("#ddlPaymentMethod").val(),c=$("#ddlBillStatus").val(),u=[];return $.each($("#tbl-bill-details tr"),function(e,n){u.push({Id:$(n).data("id"),ProductId:$(n).find("select.ddlProductId").first().val(),Quantity:$(n).find("input.txtQuantity").first().val(),ColorId:$(n).find("select.ddlColorId").first().val(),SizeId:$(n).find("select.ddlSizeId").first().val(),BillId:t})}),$.ajax({type:"POST",url:"/Admin/Bill/SaveEntity",data:{Id:t,BillStatus:c,CustomerAddress:a,CustomerId:o,CustomerMessage:r,CustomerMobile:i,CustomerName:n,PaymentMethod:d,Status:1,BillDetails:u},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){tedu.notify("Save order successful","success"),$("#modal-detail").modal("hide"),l(),tedu.stopLoading(),s(!0)},error:function(){tedu.notify("Has an error in progress","error"),tedu.stopLoading()}}),!1}}),$("#btnAddDetail").on("click",function(){var e=$("#template-table-bill-details").html(),t=r(null),n=d(null),a=c(null),o=Mustache.render(e,{Id:0,Products:t,Colors:n,Sizes:a,Quantity:0,Total:0});$("#tbl-bill-details").append(o)}),$("body").on("click",".btn-delete-detail",function(){$(this).parent().parent().remove()}),$("#btnExport").on("click",function(){var e=$("#hidId").val();$.ajax({type:"POST",url:"/Admin/Bill/ExportExcel",data:{billId:e},beforeSend:function(){tedu.startLoading()},success:function(e){window.location.href=e,tedu.stopLoading()}})})}function t(){return $.ajax({type:"GET",url:"/admin/bill/GetBillStatus",dataType:"json",success:function(e){m.billStatuses=e;var t="";$.each(e,function(e,n){t+="<option value='"+n.Value+"'>"+n.Name+"</option>"}),$("#ddlBillStatus").html(t)}})}function n(){return $.ajax({type:"GET",url:"/admin/bill/GetPaymentMethod",dataType:"json",success:function(e){m.paymentMethods=e;var t="";$.each(e,function(e,n){t+="<option value='"+n.Value+"'>"+n.Name+"</option>"}),$("#ddlPaymentMethod").html(t)}})}function a(){return $.ajax({type:"GET",url:"/Admin/Product/GetAll",dataType:"json",success:function(e){m.products=e},error:function(){tedu.notify("Has an error in progress","error")}})}function o(){return $.ajax({type:"GET",url:"/Admin/Bill/GetColors",dataType:"json",success:function(e){m.colors=e},error:function(){tedu.notify("Has an error in progress","error")}})}function i(){return $.ajax({type:"GET",url:"/Admin/Bill/GetSizes",dataType:"json",success:function(e){m.sizes=e},error:function(){tedu.notify("Has an error in progress","error")}})}function r(e){var t="<select class='form-control ddlProductId'>";return $.each(m.products,function(n,a){t+=e===a.Id?'<option value="'+a.Id+'" selected="select">'+a.Name+"</option>":'<option value="'+a.Id+'">'+a.Name+"</option>"}),t+="</select>"}function d(e){var t="<select class='form-control ddlColorId'>";return $.each(m.colors,function(n,a){t+=e===a.Id?'<option value="'+a.Id+'" selected="select">'+a.Name+"</option>":'<option value="'+a.Id+'">'+a.Name+"</option>"}),t+="</select>"}function c(e){var t="<select class='form-control ddlSizeId'>";return $.each(m.sizes,function(n,a){t+=e===a.Id?'<option value="'+a.Id+'" selected="select">'+a.Name+"</option>":'<option value="'+a.Id+'">'+a.Name+"</option>"}),t+="</select>"}function l(){$("#hidId").val(0),$("#txtCustomerName").val(""),$("#txtCustomerAddress").val(""),$("#txtCustomerMobile").val(""),$("#txtCustomerMessage").val(""),$("#ddlPaymentMethod").val(""),$("#ddlCustomerId").val(""),$("#ddlBillStatus").val(""),$("#tbl-bill-details").html("")}function s(e){$.ajax({type:"GET",url:"/admin/bill/GetAllPaging",data:{startDate:$("#txtFromDate").val(),endDate:$("#txtToDate").val(),keyword:$("#txtSearchKeyword").val(),page:tedu.configs.pageIndex,pageSize:tedu.configs.pageSize},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(t){var n=$("#table-template").html(),a="";t.RowCount>0?($.each(t.Results,function(e,t){a+=Mustache.render(n,{CustomerName:t.CustomerName,Id:t.Id,PaymentMethod:u(t.PaymentMethod),DateCreated:tedu.dateTimeFormatJson(t.DateCreated),BillStatus:p(t.BillStatus)})}),$("#lbl-total-records").text(t.RowCount),void 0!=a&&$("#tbl-content").html(a),f(t.RowCount,function(){s()},e)):($("#lbl-total-records").text("0"),$("#tbl-content").html("")),tedu.stopLoading()},error:function(e){console.log(e)}})}function u(e){var t=$.grep(m.paymentMethods,function(t,n){return t.Value==e});return t.length>0?t[0].Name:""}function p(e){var e=$.grep(m.billStatuses,function(t,n){return t.Value==e});return e.length>0?e[0].Name:""}function f(e,t,n){var a=Math.ceil(e/tedu.configs.pageSize);0!==$("#paginationUL a").length&&n!==!0||($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:a,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(e,n){tedu.configs.pageIndex=n,setTimeout(t(),200)}})}var m={products:[],colors:[],sizes:[],paymentMethods:[],billStatuses:[]};this.initialize=function(){$.when(t(),n(),o(),i(),a()).done(function(){s()}),e()}},HomeController=function(){function e(e,n){$.ajax({type:"GET",url:"/Admin/Home/GetRevenue",data:{fromDate:e,toDate:n},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){t(e),tedu.stopLoading()},error:function(e){tedu.notify("Có lỗi xảy ra","error"),tedu.stopLoading()}})}function t(e){var t=[],n=[];$.each(e,function(e,n){t.push([new Date(n.Date).getTime(),n.Revenue])}),$.each(e,function(e,t){n.push([new Date(t.Date).getTime(),t.Profit])});var a={grid:{show:!0,aboveData:!0,color:"#3f3f3f",labelMargin:10,axisMargin:0,borderWidth:0,borderColor:null,minBorderMargin:5,clickable:!0,hoverable:!0,autoHighlight:!0,mouseActiveRadius:100},series:{lines:{show:!0,fill:!0,lineWidth:2,steps:!1},points:{show:!0,radius:4.5,symbol:"circle",lineWidth:3}},legend:{position:"ne",margin:[0,-25],noColumns:0,labelBoxBorderColor:null,labelFormatter:function(e,t){return e+"&nbsp;&nbsp;"},width:40,height:1},colors:["#96CA59","#3F97EB","#72c380","#6f7a8a","#f7cb38","#5a8022","#2c7282"],shadowSize:0,tooltip:!0,tooltipOpts:{content:"%s: %y.0",xDateFormat:"%d/%m",shifts:{x:-30,y:-50},defaultTheme:!1},yaxis:{min:0},xaxis:{mode:"time",minTickSize:[1,"day"],timeformat:"%d/%m/%y"}};$("#chart_plot_02").length&&(console.log("Plot2"),$.plot($("#chart_plot_02"),[{label:"Revenue",data:t,lines:{fillColor:"rgba(150, 202, 89, 0.12)"},points:{fillColor:"#fff"}},{label:"Profit",data:n,lines:{fillColor:"rgba(140, 232, 289, 0.12)"},points:{fillColor:"#fff"}}],a))}function n(){if("undefined"!=typeof $.fn.daterangepicker){console.log("init_daterangepicker");var t=function(e,t,n){console.log(e.toISOString(),t.toISOString(),n),$("#reportrange span").html(e.format("MMMM D, YYYY")+" - "+t.format("MMMM D, YYYY"))},n={startDate:moment().subtract(29,"days"),endDate:moment(),minDate:"01/01/2012",maxDate:moment().format("MM/DD/YYYY"),dateLimit:{days:60},showDropdowns:!0,showWeekNumbers:!0,timePicker:!1,timePickerIncrement:1,timePicker12Hour:!0,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"left",buttonClasses:["btn btn-default"],applyClass:"btn-small btn-primary",cancelClass:"btn-small",format:"MM/DD/YYYY",separator:" to ",locale:{applyLabel:"Submit",cancelLabel:"Clear",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1}};$("#reportrange span").html(moment().subtract(29,"days").format("MMMM D, YYYY")+" - "+moment().format("MMMM D, YYYY")),$("#reportrange").daterangepicker(n,t),$("#reportrange").on("show.daterangepicker",function(){console.log("show event fired")}),$("#reportrange").on("hide.daterangepicker",function(){console.log("hide event fired")}),$("#reportrange").on("apply.daterangepicker",function(t,n){console.log("apply event fired, start/end dates are "+n.startDate.format("MMMM D, YYYY")+" to "+n.endDate.format("MMMM D, YYYY")),e(n.startDate.format("MM/DD/YYYY"),n.endDate.format("MM/DD/YYYY"))}),$("#reportrange").on("cancel.daterangepicker",function(e,t){console.log("cancel event fired")}),$("#options1").click(function(){$("#reportrange").data("daterangepicker").setOptions(n,t)}),$("#options2").click(function(){$("#reportrange").data("daterangepicker").setOptions(optionSet2,t)}),$("#destroy").click(function(){$("#reportrange").data("daterangepicker").remove()})}}this.initialize=function(){n(),e()}},loginController=function(){this.initialize=function(){e()};var e=function(){$("#frmLogin").validate({errorClass:"red",ignore:[],lang:"en",rules:{userName:{required:!0},password:{required:!0}}}),$("#btnLogin").on("click",function(e){if($("#frmLogin").valid()){e.preventDefault();var n=$("#txtUserName").val(),a=$("#txtPassword").val();t(n,a)}})},t=function(e,t){$.ajax({type:"POST",data:{Email:e,Password:t},dateType:"json",url:"/admin/login/authen",success:function(e){e.Success?window.location.href="/Admin/Home/Index":tedu.notify("Login failed","error")}})}},PageController=function(){function e(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtNameM:{required:!0},txtAliasM:{required:!0}}}),$("#txt-search-keyword").keypress(function(e){13===e.which&&(e.preventDefault(),a())}),$("#btn-search").on("click",function(){a()}),$("#ddl-show-page").on("change",function(){tedu.configs.pageSize=$(this).val(),tedu.configs.pageIndex=1,a(!0)}),$("#btn-create").on("click",function(){t(),$("#modal-add-edit").modal("show")}),$("body").on("click",".btn-edit",function(e){e.preventDefault();var t=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Page/GetById",data:{id:t},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){var t=e;$("#hidIdM").val(t.Id),$("#txtNameM").val(t.Name),$("#txtAliasM").val(t.Alias),CKEDITOR.instances.txtContentM.setData(t.Content),$("#ckStatusM").prop("checked",1===t.Status),$("#modal-add-edit").modal("show"),tedu.stopLoading()},error:function(){tedu.notify("Có lỗi xảy ra","error"),tedu.stopLoading()}})}),$("#btnSaveM").on("click",function(e){if($("#frmMaintainance").valid()){e.preventDefault();var n=$("#hidIdM").val(),o=$("#txtNameM").val(),i=$("#txtAliasM").val(),r=CKEDITOR.instances.txtContentM.getData(),d=$("#ckStatusM").prop("checked")===!0?1:0;return $.ajax({type:"POST",url:"/Admin/Page/SaveEntity",data:{Id:n,Name:o,Content:r,Status:d,Alias:i},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(){tedu.notify("Update page successful","success"),$("#modal-add-edit").modal("hide"),t(),tedu.stopLoading(),a(!0)},error:function(){tedu.notify("Have an error in progress","error"),tedu.stopLoading()}}),!1}return!1}),$("body").on("click",".btn-delete",function(e){e.preventDefault();var t=$(this).data("id");tedu.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Page/Delete",data:{id:t},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(){tedu.notify("Delete page successful","success"),tedu.stopLoading(),a()},error:function(){tedu.notify("Have an error in progress","error"),tedu.stopLoading()}})})})}function t(){$("#hidIdM").val(0),$("#txtNameM").val(""),$("#txtAliasM").val(""),CKEDITOR.instances.txtContentM.setData(""),$("#ckStatusM").prop("checked",!0)}function n(){var e={filebrowserImageUploadUrl:"/Admin/Upload/UploadImageForCKEditor?type=Images"};CKEDITOR.replace("txtContentM",e),$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||$(e.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}}function a(e){$.ajax({type:"GET",url:"/admin/page/GetAllPaging",data:{keyword:$("#txt-search-keyword").val(),page:tedu.configs.pageIndex,pageSize:tedu.configs.pageSize},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(t){var n=$("#table-template").html(),i="";t.RowCount>0?($.each(t.Results,function(e,t){i+=Mustache.render(n,{Name:t.Name,Alias:t.Alias,Id:t.Id,Status:tedu.getStatus(t.Status)})}),$("#lbl-total-records").text(t.RowCount),void 0!=i&&$("#tbl-content").html(i),o(t.RowCount,function(){a()},e)):$("#tbl-content").html(""),tedu.stopLoading()},error:function(e){console.log(e)}})}function o(e,t,n){var a=Math.ceil(e/tedu.configs.pageSize);0!==$("#paginationUL a").length&&n!==!0||($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:a,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(e,n){tedu.configs.pageIndex=n,setTimeout(t(),200)}})}this.initialize=function(){a(),e(),n()}},RoleController=function(){function e(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"vi",rules:{txtName:{required:!0}}}),$("#txt-search-keyword").keypress(function(e){13==e.which&&(e.preventDefault(),o())}),$("#btn-search").on("click",function(){o()}),$("#ddl-show-page").on("change",function(){tedu.configs.pageSize=$(this).val(),tedu.configs.pageIndex=1,o(!0)}),$("#btn-create").on("click",function(){a(),$("#modal-add-edit").modal("show")}),$("body").on("click",".btn-grant",function(){$("#hidRoleId").val($(this).data("id")),$.when(t()).done(n($("#hidRoleId").val())),$("#modal-grantpermission").modal("show")}),$("body").on("click",".btn-edit",function(e){e.preventDefault();var t=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Role/GetById",data:{id:t},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){var t=e;$("#hidId").val(t.Id),$("#txtName").val(t.Name),$("#txtDescription").val(t.Description),$("#modal-add-edit").modal("show"),tedu.stopLoading()},error:function(e){tedu.notify("Có lỗi xảy ra","error"),tedu.stopLoading()}})}),$("#btnSave").on("click",function(e){if($("#frmMaintainance").valid()){e.preventDefault();var t=$("#hidId").val(),n=$("#txtName").val(),i=$("#txtDescription").val();return $.ajax({type:"POST",url:"/Admin/Role/SaveEntity",data:{Id:t,Name:n,Description:i},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){tedu.notify("Update role successful","success"),$("#modal-add-edit").modal("hide"),a(),tedu.stopLoading(),o(!0)},error:function(){tedu.notify("Has an error","error"),tedu.stopLoading()}}),!1}}),$("body").on("click",".btn-delete",function(e){e.preventDefault();var t=$(this).data("id");tedu.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Role/Delete",data:{id:t},beforeSend:function(){tedu.startLoading()},success:function(e){tedu.notify("Delete successful","success"),tedu.stopLoading(),o()},error:function(e){tedu.notify("Has an error in deleting progress","error"),tedu.stopLoading()}})})}),$("#btnSavePermission").off("click").on("click",function(){var e=[];$.each($("#tblFunction tbody tr"),function(t,n){e.push({RoleId:$("#hidRoleId").val(),FunctionId:$(n).data("id"),CanRead:$(n).find(".ckView").first().prop("checked"),CanCreate:$(n).find(".ckAdd").first().prop("checked"),CanUpdate:$(n).find(".ckEdit").first().prop("checked"),CanDelete:$(n).find(".ckDelete").first().prop("checked")})}),$.ajax({type:"POST",url:"/admin/role/SavePermission",data:{listPermmission:e,roleId:$("#hidRoleId").val()},beforeSend:function(){tedu.startLoading()},success:function(e){tedu.notify("Save permission successful","success"),$("#modal-grantpermission").modal("hide"),tedu.stopLoading()},error:function(){tedu.notify("Has an error in save permission progress","error"),tedu.stopLoading()}})})}function t(e){var t="/admin/Function/GetAll";return $.ajax({type:"GET",url:t,dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(t){var n=$("#result-data-function").html(),a="";$.each(t,function(e,t){a+=Mustache.render(n,{Name:t.Name,treegridparent:null!=t.ParentId?"treegrid-parent-"+t.ParentId:"",Id:t.Id,AllowCreate:t.AllowCreate?"checked":"",AllowEdit:t.AllowEdit?"checked":"",AllowView:t.AllowView?"checked":"",AllowDelete:t.AllowDelete?"checked":"",Status:tedu.getStatus(t.Status)})}),void 0!=a&&$("#lst-data-function").html(a),$(".tree").treegrid(),$("#ckCheckAllView").on("click",function(){$(".ckView").prop("checked",$(this).prop("checked"))}),$("#ckCheckAllCreate").on("click",function(){$(".ckAdd").prop("checked",$(this).prop("checked"))}),$("#ckCheckAllEdit").on("click",function(){$(".ckEdit").prop("checked",$(this).prop("checked"))}),$("#ckCheckAllDelete").on("click",function(){$(".ckDelete").prop("checked",$(this).prop("checked"))}),$(".ckView").on("click",function(){$(".ckView:checked").length==t.length?$("#ckCheckAllView").prop("checked",!0):$("#ckCheckAllView").prop("checked",!1)}),$(".ckAdd").on("click",function(){$(".ckAdd:checked").length==t.length?$("#ckCheckAllCreate").prop("checked",!0):$("#ckCheckAllCreate").prop("checked",!1)}),$(".ckEdit").on("click",function(){$(".ckEdit:checked").length==t.length?$("#ckCheckAllEdit").prop("checked",!0):$("#ckCheckAllEdit").prop("checked",!1)}),$(".ckDelete").on("click",function(){$(".ckDelete:checked").length==t.length?$("#ckCheckAllDelete").prop("checked",!0):$("#ckCheckAllDelete").prop("checked",!1)}),void 0!=e&&e(),tedu.stopLoading()},error:function(e){console.log(e)}})}function n(e){var t="/Admin/Role/ListAllFunction";return $.ajax({type:"POST",url:t,data:{roleId:e},dataType:"json",beforeSend:function(){tedu.stopLoading()},success:function(e){var t=e;$.each($("#tblFunction tbody tr"),function(e,n){$.each(t,function(e,t){t.FunctionId==$(n).data("id")&&($(n).find(".ckView").first().prop("checked",t.CanRead),$(n).find(".ckAdd").first().prop("checked",t.CanCreate),$(n).find(".ckEdit").first().prop("checked",t.CanUpdate),$(n).find(".ckDelete").first().prop("checked",t.CanDelete))})}),$(".ckView:checked").length==$("#tblFunction tbody tr .ckView").length?$("#ckCheckAllView").prop("checked",!0):$("#ckCheckAllView").prop("checked",!1),$(".ckAdd:checked").length==$("#tblFunction tbody tr .ckAdd").length?$("#ckCheckAllCreate").prop("checked",!0):$("#ckCheckAllCreate").prop("checked",!1),$(".ckEdit:checked").length==$("#tblFunction tbody tr .ckEdit").length?$("#ckCheckAllEdit").prop("checked",!0):$("#ckCheckAllEdit").prop("checked",!1),$(".ckDelete:checked").length==$("#tblFunction tbody tr .ckDelete").length?$("#ckCheckAllDelete").prop("checked",!0):$("#ckCheckAllDelete").prop("checked",!1),tedu.stopLoading()},error:function(e){console.log(e)}})}function a(){$("#hidId").val(""),$("#txtName").val(""),$("#txtDescription").val("")}function o(e){$.ajax({type:"GET",url:"/admin/role/GetAllPaging",data:{keyword:$("#txt-search-keyword").val(),page:tedu.configs.pageIndex,pageSize:tedu.configs.pageSize},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(t){var n=$("#table-template").html(),a="";t.RowCount>0?($.each(t.Results,function(e,t){a+=Mustache.render(n,{Name:t.Name,Id:t.Id,Description:t.Description})}),$("#lbl-total-records").text(t.RowCount),void 0!=a&&$("#tbl-content").html(a),i(t.RowCount,function(){o()},e)):$("#tbl-content").html(""),tedu.stopLoading()},error:function(e){console.log(e)}})}function i(e,t,n){var a=Math.ceil(e/tedu.configs.pageSize);0!==$("#paginationUL a").length&&n!==!0||($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:a,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(e,n){tedu.configs.pageIndex=n,setTimeout(t(),200)}})}this.initialize=function(){o(),e()}},productCategoryController=function(){function e(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtNameM:{required:!0},txtOrderM:{number:!0},txtHomeOrderM:{number:!0}}}),$("#btnCreate").off("click").on("click",function(){a(),$("#modal-add-edit").modal("show")}),$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()}),$("#fileInputImage").on("change",function(){for(var e=$(this).get(0),t=e.files,n=new FormData,a=0;a<t.length;a++)n.append(t[a].name,t[a]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImage",contentType:!1,processData:!1,data:n,success:function(e){$("#txtImage").val(e),tedu.notify("Upload image succesful!","success")},error:function(){tedu.notify("There was error uploading files!","error")}})}),$("body").on("click","#btnEdit",function(e){e.preventDefault();var t=$("#hidIdM").val();$.ajax({type:"GET",url:"/Admin/ProductCategory/GetById",data:{id:t},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){n(),console.log(e);$("#hidIdM").val(e.Id),$("#txtNameM").val(e.Name),a(e.CategoryId),$("#txtDescM").val(e.Description),$("#txtImage").val(e.ThumbnailImage),$("#txtSeoKeywordM").val(e.SeoKeywords),$("#txtSeoDescriptionM").val(e.SeoDescription),$("#txtSeoPageTitleM").val(e.SeoPageTitle),$("#txtSeoAliasM").val(e.SeoAlias),$("#ckStatusM").prop("checked",1==e.Status),$("#ckShowHomeM").prop("checked",e.HomeFlag),$("#txtOrderM").val(e.SortOrder),$("#txtHomeOrderM").val(e.HomeOrder),$("#modal-add-edit").modal("show"),tedu.stopLoading()},error:function(e){console.log(e),tedu.notify("Có lỗi xảy ra","error"),tedu.stopLoading()}})}),$("body").on("click","#btnDelete",function(e){e.preventDefault();var n=$("#hidIdM").val();tedu.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/ProductCategory/Delete",data:{id:n},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){tedu.notify("Deleted success","success"),tedu.stopLoading(),t()},error:function(e){tedu.notify("Has an error in deleting progress","error"),tedu.stopLoading()}})})}),$("#btnSave").on("click",function(e){if($("#frmMaintainance").valid()){e.preventDefault();var a=parseInt($("#hidIdM").val()),o=$("#txtNameM").val(),i=$("#ddlCategoryIdM").combotree("getValue"),r=$("#txtDescM").val(),d=$("#txtImage").val(),c=parseInt($("#txtOrderM").val()),l=$("#txtHomeOrderM").val(),s=$("#txtSeoKeywordM").val(),u=$("#txtSeoDescriptionM").val(),p=$("#txtSeoPageTitleM").val(),f=$("#txtSeoAliasM").val(),m=1==$("#ckStatusM").prop("checked")?1:0,g=$("#ckShowHomeM").prop("checked");$.ajax({type:"POST",url:"/Admin/ProductCategory/SaveEntity",data:{Id:a,Name:o,Description:r,ParentId:i,HomeOrder:l,SortOrder:c,HomeFlag:g,Image:d,Status:m,SeoPageTitle:p,SeoAlias:f,SeoKeywords:s,SeoDescription:u},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){tedu.notify("Update success","success"),$("#modal-add-edit").modal("hide"),n(),tedu.stopLoading(),t(!0)},error:function(){tedu.notify("Has an error in update progress","error"),tedu.stopLoading()}})}return!1})}function t(){$.ajax({url:"/Admin/ProductCategory/GetAll",dataType:"json",success:function(e){var n=[];$.each(e,function(e,t){n.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});var a=tedu.unflattern(n);a.sort(function(e,t){return e.sortOrder-t.sortOrder}),$("#treeProductCategory").tree({data:a,dnd:!0,onContextMenu:function(e,t){e.preventDefault(),$("#hidIdM").val(t.id),$("#contextMenu").menu("show",{left:e.pageX,top:e.pageY})},onDrop:function(e,n,a){console.log(e),console.log(n),console.log(a);var o=$(this).tree("getNode",e);if("append"===a){var i=[];$.each(o.children,function(e,t){i.push({key:t.id,value:e})}),$.ajax({url:"/Admin/ProductCategory/UpdateParentId",type:"post",dataType:"json",data:{sourceId:n.id,targetId:o.id,items:i},success:function(e){t()}})}else"top"!==a&&"bottom"!==a||$.ajax({url:"/Admin/ProductCategory/ReOrder",type:"post",dataType:"json",data:{sourceId:n.id,targetId:o.id},success:function(e){t()}})}})}})}function n(){$("#hidIdM").val(0),$("#txtNameM").val(""),a(""),$("#txtDescM").val(""),$("#txtOrderM").val(""),$("#txtHomeOrderM").val(""),$("#txtImageM").val(""),$("#txtMetakeywordM").val(""),$("#txtMetaDescriptionM").val(""),$("#txtSeoPageTitleM").val(""),$("#txtSeoAliasM").val(""),$("#ckStatusM").prop("checked",!0),$("#ckShowHomeM").prop("checked",!1)}function a(e){$.ajax({url:"/Admin/ProductCategory/GetAll",type:"GET",dataType:"json",async:!1,success:function(t){var n=[];$.each(t,function(e,t){n.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});var a=tedu.unflattern(n);$("#ddlCategoryIdM").combotree({data:a}),void 0!=e&&$("#ddlCategoryIdM").combotree("setValue",e)}})}this.initialize=function(){t(),e()}},UserController=function(){function e(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtFullName:{required:!0},txtUserName:{required:!0},txtPassword:{required:!0,minlength:6},txtConfirmPassword:{equalTo:"#txtPassword"},txtEmail:{required:!0,email:!0}}}),$("#txt-search-keyword").keypress(function(e){13===e.which&&(e.preventDefault(),o())}),$("#btn-search").on("click",function(){o()}),$("#ddl-show-page").on("change",function(){tedu.configs.pageSize=$(this).val(),tedu.configs.pageIndex=1,o(!0)}),$("#btn-create").on("click",function(){n(),a(),$("#modal-add-edit").modal("show")}),$("body").on("click",".btn-edit",function(e){e.preventDefault();var n=$(this).data("id");$.ajax({type:"GET",url:"/Admin/User/GetById",data:{id:n},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){var n=e;$("#hidId").val(n.Id),$("#txtFullName").val(n.FullName),$("#txtUserName").val(n.UserName),$("#txtEmail").val(n.Email),$("#txtPhoneNumber").val(n.PhoneNumber),$("#ckStatus").prop("checked",1===n.Status),a(n.Roles),t(!0),$("#modal-add-edit").modal("show"),tedu.stopLoading()},error:function(){tedu.notify("Có lỗi xảy ra","error"),tedu.stopLoading()}})}),$("#btnSave").on("click",function(e){if($("#frmMaintainance").valid()){e.preventDefault();var t=$("#hidId").val(),a=$("#txtFullName").val(),i=$("#txtUserName").val(),r=$("#txtPassword").val(),d=$("#txtEmail").val(),c=$("#txtPhoneNumber").val(),l=[];$.each($('input[name="ckRoles"]'),function(e,t){$(t).prop("checked")===!0&&l.push($(t).prop("value"))});var s=$("#ckStatus").prop("checked")===!0?1:0;$.ajax({type:"POST",url:"/Admin/User/SaveEntity",data:{Id:t,FullName:a,UserName:i,Password:r,Email:d,PhoneNumber:c,Status:s,Roles:l},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(){tedu.notify("Save user succesful","success"),$("#modal-add-edit").modal("hide"),n(),tedu.stopLoading(),o(!0)},error:function(){tedu.notify("Has an error","error"),tedu.stopLoading()}})}return!1}),$("body").on("click",".btn-delete",function(e){e.preventDefault();var t=$(this).data("id");tedu.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/User/Delete",data:{id:t},beforeSend:function(){tedu.startLoading()},success:function(){tedu.notify("Delete successful","success"),tedu.stopLoading(),o()},error:function(){tedu.notify("Has an error","error"),tedu.stopLoading()}})})})}function t(e){$("#txtUserName").prop("disabled",e),$("#txtPassword").prop("disabled",e),$("#txtConfirmPassword").prop("disabled",e)}function n(){t(!1),$("#hidId").val(""),a(),$("#txtFullName").val(""),$("#txtUserName").val(""),$("#txtPassword").val(""),$("#txtConfirmPassword").val(""),$('input[name="ckRoles"]').removeAttr("checked"),$("#txtEmail").val(""),$("#txtPhoneNumber").val(""),$("#ckStatus").prop("checked",!0)}function a(e){$.ajax({url:"/Admin/Role/GetAll",type:"GET",dataType:"json",async:!1,success:function(t){var n=$("#role-template").html(),a=t,o="";$.each(a,function(t,a){var i="";void 0!==e&&e.indexOf(a.Name)!==-1&&(i="checked"),o+=Mustache.render(n,{Name:a.Name,Description:a.Description,Checked:i})}),$("#list-roles").html(o)}})}function o(e){$.ajax({type:"GET",url:"/admin/user/GetAllPaging",data:{categoryId:$("#ddl-category-search").val(),keyword:$("#txt-search-keyword").val(),page:tedu.configs.pageIndex,pageSize:tedu.configs.pageSize},dataType:"json",beforeSend:function(){tedu.startLoading();
},success:function(t){var n=$("#table-template").html(),a="";t.RowCount>0?($.each(t.Results,function(e,t){a+=Mustache.render(n,{FullName:t.FullName,Id:t.Id,UserName:t.UserName,Avatar:void 0===t.Avatar?'<img src="/admin-side/images/user.png" width=25 />':'<img src="'+t.Avatar+'" width=25 />',DateCreated:tedu.dateTimeFormatJson(t.DateCreated),Status:tedu.getStatus(t.Status)})}),$("#lbl-total-records").text(t.RowCount),void 0!==a&&$("#tbl-content").html(a),i(t.RowCount,function(){o()},e)):$("#tbl-content").html(""),tedu.stopLoading()},error:function(e){console.log(e)}})}function i(e,t,n){var a=Math.ceil(e/tedu.configs.pageSize);0!==$("#paginationUL a").length&&n!==!0||($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:a,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(e,n){tedu.configs.pageIndex=n,setTimeout(t(),200)}})}this.initialize=function(){o(),e()}},ImageManagement=function(){function e(){$("body").on("click",".btn-images",function(e){e.preventDefault();var a=$(this).data("id");$("#hidId").val(a),n($("#fileImage")),t(),$("#modal-image-manage").modal("show")}),$("body").on("click",".btn-delete-image",function(e){e.preventDefault(),$(this).closest("div").remove()}),$("#fileImage").on("change",function(){for(var e=$(this).get(0),t=e.files,o=new FormData,i=0;i<t.length;i++)o.append(t[i].name,t[i]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImage",contentType:!1,processData:!1,data:o,success:function(e){n($("#fileImage")),a.push(e),$("#image-list").append('<div class="col-md-3"><img width="100"  data-path="'+e+'" src="'+e+'"></div>'),tedu.notify("Đã tải ảnh lên thành công!","success")},error:function(){tedu.notify("There was error uploading files!","error")}})}),$("#btnSaveImages").on("click",function(){var e=[];$.each($("#image-list").find("img"),function(t,n){e.push($(this).data("path"))}),$.ajax({url:"/admin/Product/SaveImages",data:{productId:$("#hidId").val(),images:a},type:"post",dataType:"json",success:function(e){$("#modal-image-manage").modal("hide"),$("#image-list").html(""),n($("#fileImage"))}})})}function t(){$.ajax({url:"/admin/Product/GetImages",data:{productId:$("#hidId").val()},type:"get",dataType:"json",success:function(e){var t="";$.each(e,function(e,n){t+='<div class="col-md-3"><img width="100" src="'+n.Path+'"><br/><a href="#" class="btn-delete-image">Xóa</a></div>'}),$("#image-list").html(t),n()}})}function n(e){}var a=[];this.initialize=function(){e()}},productController=function(){function e(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"vi",rules:{txtNameM:{required:!0},ddlCategoryIdM:{required:!0},txtPriceM:{required:!0,number:!0}}}),$("#ddlShowPage").on("change",function(){tedu.configs.pageSize=$(this).val(),tedu.configs.pageIndex=1,c(!0)}),$("#btnSearch").on("click",function(){c()}),$("#txtKeyword").on("keypress",function(e){13===e.which&&c()}),$("#btnCreate").on("click",function(){r(),i(),$("#modal-add-edit").modal("show")}),$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()}),$("#fileInputImage").on("change",function(){for(var e=$(this).get(0),t=e.files,n=new FormData,a=0;a<t.length;a++)n.append(t[a].name,t[a]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImage",contentType:!1,processData:!1,data:n,success:function(e){$("#txtImage").val(e),tedu.notify("Upload image succesful!","success")},error:function(){tedu.notify("There was error uploading files!","error")}})}),$("body").on("click",".btn-edit",function(e){e.preventDefault();var t=$(this).data("id");o(t)}),$("body").on("click",".btn-delete",function(e){e.preventDefault();var t=$(this).data("id");a(t)}),$("#btnSave").on("click",function(e){n(e)}),$("#btn-import").on("click",function(){i(),$("#modal-import-excel").modal("show")}),$("#btnImportExcel").on("click",function(){for(var e=$("#fileInputExcel").get(0),t=e.files,n=new FormData,a=0;a<t.length;a++)n.append("files",t[a]);return n.append("categoryId",$("#ddlCategoryIdImportExcel").combotree("getValue")),$.ajax({url:"/Admin/Product/ImportExcel",type:"POST",data:n,processData:!1,contentType:!1,success:function(e){$("#modal-import-excel").modal("hide"),c()}}),!1}),$("#btn-export").on("click",function(){$.ajax({type:"POST",url:"/Admin/Product/ExportExcel",beforeSend:function(){tedu.startLoading()},success:function(e){window.location.href=e,tedu.stopLoading()},error:function(){tedu.notify("Has an error in progress","error"),tedu.stopLoading()}})})}function t(){CKEDITOR.replace("txtContent",{}),$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||$(e.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}}function n(e){if($("#frmMaintainance").valid()){e.preventDefault();var t=$("#hidIdM").val(),n=$("#txtNameM").val(),a=$("#ddlCategoryIdM").combotree("getValue"),o=$("#txtDescM").val(),i=$("#txtUnitM").val(),d=$("#txtPriceM").val(),l=$("#txtOriginalPriceM").val(),s=$("#txtPromotionPriceM").val(),u=$("#txtTagM").val(),p=$("#txtMetakeywordM").val(),f=$("#txtMetaDescriptionM").val(),m=$("#txtSeoPageTitleM").val(),g=$("#txtSeoAliasM").val(),h=CKEDITOR.instances.txtContent.getData(),v=1==$("#ckStatusM").prop("checked")?1:0,y=$("#ckHotM").prop("checked"),k=$("#ckShowHomeM").prop("checked");return $.ajax({type:"POST",url:"/Admin/Product/SaveEntity",data:{Id:t,Name:n,CategoryId:a,Image:"",Price:d,OriginalPrice:l,PromotionPrice:s,Description:o,Content:h,HomeFlag:k,HotFlag:y,Tags:u,Unit:i,Status:v,SeoPageTitle:m,SeoAlias:g,SeoKeywords:p,SeoDescription:f},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){tedu.notify("Update product successful","success"),$("#modal-add-edit").modal("hide"),r(),tedu.stopLoading(),c(!0)},error:function(){tedu.notify("Has an error in save product progress","error"),tedu.stopLoading()}}),!1}}function a(e){tedu.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Product/Delete",data:{id:that},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){tedu.notify("Delete successful","success"),tedu.stopLoading(),c()},error:function(e){tedu.notify("Has an error in delete progress","error"),tedu.stopLoading()}})})}function o(e){$.ajax({type:"GET",url:"/Admin/Product/GetById",data:{id:e},dataType:"json",beforeSend:function(){tedu.startLoading()},success:function(e){var t=e;$("#hidIdM").val(t.Id),$("#txtNameM").val(t.Name),i(t.CategoryId),$("#txtDescM").val(t.Description),$("#txtUnitM").val(t.Unit),$("#txtPriceM").val(t.Price),$("#txtOriginalPriceM").val(t.OriginalPrice),$("#txtPromotionPriceM").val(t.PromotionPrice),$("#txtTagM").val(t.Tags),$("#txtMetakeywordM").val(t.SeoKeywords),$("#txtMetaDescriptionM").val(t.SeoDescription),$("#txtSeoPageTitleM").val(t.SeoPageTitle),$("#txtSeoAliasM").val(t.SeoAlias),CKEDITOR.instances.txtContent.setData(t.Content),$("#ckStatusM").prop("checked",1==t.Status),$("#ckHotM").prop("checked",t.HotFlag),$("#ckShowHomeM").prop("checked",t.HomeFlag),$("#modal-add-edit").modal("show"),tedu.stopLoading()},error:function(e){tedu.notify("Có lỗi xảy ra","error"),tedu.stopLoading()}})}function i(e){$.ajax({url:"/Admin/ProductCategory/GetAll",type:"GET",dataType:"json",async:!1,success:function(t){var n=[];$.each(t,function(e,t){n.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});var a=tedu.unflattern(n);$("#ddlCategoryIdM").combotree({data:a}),$("#ddlCategoryIdImportExcel").combotree({data:a}),void 0!=e&&$("#ddlCategoryIdM").combotree("setValue",e)}})}function r(){$("#hidIdM").val(0),$("#txtNameM").val(""),i(""),$("#txtDescM").val(""),$("#txtUnitM").val(""),$("#txtPriceM").val("0"),$("#txtOriginalPriceM").val(""),$("#txtPromotionPriceM").val(""),$("#txtTagM").val(""),$("#txtMetakeywordM").val(""),$("#txtMetaDescriptionM").val(""),$("#txtSeoPageTitleM").val(""),$("#txtSeoAliasM").val(""),$("#ckStatusM").prop("checked",!0),$("#ckHotM").prop("checked",!1),$("#ckShowHomeM").prop("checked",!1)}function d(){$.ajax({type:"GET",url:"/admin/product/GetAllCategories",dataType:"json",success:function(e){var t="<option value=''>--Select category--</option>";$.each(e,function(e,n){t+="<option value='"+n.Id+"'>"+n.Name+"</option>"}),$("#ddlCategorySearch").html(t)},error:function(e){console.log(e),tedu.notify("Cannot loading product category data","error")}})}function c(e){var t=$("#table-template").html(),n="";$.ajax({type:"GET",data:{categoryId:$("#ddlCategorySearch").val(),keyword:$("#txtKeyword").val(),page:tedu.configs.pageIndex,pageSize:tedu.configs.pageSize},url:"/admin/product/GetAllPaging",dataType:"json",success:function(a){console.log(a),$.each(a.Results,function(e,a){n+=Mustache.render(t,{Id:a.Id,Name:a.Name,Image:null==a.Image?'<img src="/admin-side/images/user.png" width=25':'<img src="'+a.Image+'" width=25 />',CategoryName:a.ProductCategory.Name,Price:tedu.formatNumber(a.Price,0),CreatedDate:tedu.dateTimeFormatJson(a.DateCreated),Status:tedu.getStatus(a.Status)})}),$("#lblTotalRecords").text(a.RowCount),""!=n&&$("#tbl-content").html(n),l(a.RowCount,function(){c()},e)},error:function(e){console.log(e),tedu.notify("Cannot loading data","error")}})}function l(e,t,n){var a=Math.ceil(e/tedu.configs.pageSize);0!==$("#paginationUL a").length&&n!==!0||($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:a,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(e,n){tedu.configs.pageIndex=n,setTimeout(t(),200)}})}var s=new QuantityManagement,u=new ImageManagement,p=new WholePriceManagement;this.initialize=function(){d(),c(),e(),t(),s.initialize(),u.initialize(),p.initialize()}},QuantityManagement=function(){function e(){$("body").on("click",".btn-quantity",function(e){e.preventDefault();var n=$(this).data("id");$("#hidId").val(n),t(),$("#modal-quantity-management").modal("show")}),$("body").on("click",".btn-delete-quantity",function(e){e.preventDefault(),$(this).closest("tr").remove()}),$("#btn-add-quantity").on("click",function(){var e=$("#template-table-quantity").html(),t=Mustache.render(e,{Id:0,Colors:o(null),Sizes:i(null),Quantity:0});$("#table-quantity-content").append(t)}),$("#btnSaveQuantity").on("click",function(){var e=[];$.each($("#table-quantity-content").find("tr"),function(t,n){e.push({Id:$(n).data("id"),ProductId:$("#hidId").val(),Quantity:$(n).find("input.txtQuantity").first().val(),SizeId:$(n).find("select.ddlSizeId").first().val(),ColorId:$(n).find("select.ddlColorId").first().val()})}),$.ajax({url:"/admin/Product/SaveQuantities",data:{productId:$("#hidId").val(),quantities:e},type:"post",dataType:"json",success:function(e){$("#modal-quantity-management").modal("hide"),$("#table-quantity-content").html("")}})})}function t(){$.ajax({url:"/admin/Product/GetQuantities",data:{productId:$("#hidId").val()},type:"get",dataType:"json",success:function(e){var t="",n=$("#template-table-quantity").html();$.each(e,function(e,a){t+=Mustache.render(n,{Id:a.Id,Colors:o(a.ColorId),Sizes:i(a.SizeId),Quantity:a.Quantity})}),$("#table-quantity-content").html(t),resetFile()}})}function n(){return $.ajax({type:"GET",url:"/Admin/Bill/GetColors",dataType:"json",success:function(e){r.colors=e},error:function(){tedu.notify("Có lỗi xảy ra","error")}})}function a(){return $.ajax({type:"GET",url:"/Admin/Bill/GetSizes",dataType:"json",success:function(e){r.sizes=e},error:function(){tedu.notify("Có lỗi xảy ra","error")}})}function o(e){var t="<select class='form-control ddlColorId'>";return $.each(r.colors,function(n,a){t+=e===a.Id?'<option value="'+a.Id+'" selected="select">'+a.Name+"</option>":'<option value="'+a.Id+'">'+a.Name+"</option>"}),t+="</select>"}function i(e){var t="<select class='form-control ddlSizeId'>";return $.each(r.sizes,function(n,a){t+=e===a.Id?'<option value="'+a.Id+'" selected="select">'+a.Name+"</option>":'<option value="'+a.Id+'">'+a.Name+"</option>"}),t+="</select>"}var r={colors:[],sizes:[]};this.initialize=function(){n(),a(),e()}},WholePriceManagement=function(e){function t(){$("body").on("click",".btn-whole-price",function(e){e.preventDefault();var t=$(this).data("id");$("#hidId").val(t),n(),$("#modal-whole-price").modal("show")}),$("body").on("click",".btn-delete-whole-price",function(e){e.preventDefault(),$(this).closest("tr").remove()}),$("#btn-add-whole-price").on("click",function(){var e=$("#template-table-whole-price").html(),t=Mustache.render(e,{Id:0,FromQuantity:0,ToQuantity:0,Price:0});$("#table-content-whole-price").append(t)}),$("#btnSaveWholePrice").on("click",function(){var e=[];$.each($("#table-content-whole-price").find("tr"),function(t,n){e.push({Id:$(n).data("id"),ProductId:$("#hidId").val(),FromQuantity:$(n).find("input.txtQuantityFrom").first().val(),ToQuantity:$(n).find("input.txtQuantityTo").first().val(),Price:$(n).find("input.txtWholePrice").first().val()})}),$.ajax({url:"/admin/Product/SaveWholePrice",data:{productId:$("#hidId").val(),wholePrices:e},type:"post",dataType:"json",success:function(e){$("#modal-whole-price").modal("hide"),$("#table-content-whole-price").html("")}})})}function n(){$.ajax({url:"/admin/Product/GetWholePrices",data:{productId:$("#hidId").val()},type:"get",dataType:"json",success:function(e){var t="",n=$("#template-table-whole-price").html();$.each(e,function(e,a){t+=Mustache.render(n,{Id:a.Id,FromQuantity:a.FromQuantity,ToQuantity:a.ToQuantity,Price:a.Price})}),$("#table-content-whole-price").html(t)}})}this.initialize=function(){t()}};